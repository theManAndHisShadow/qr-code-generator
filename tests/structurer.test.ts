import {prepareData} from '../src/ts/qr';
import {divideIntoBlocks, getBlocksAmount} from '../src/ts/structurer';

let text1 = 'Hello';
let text2 = `Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod 
tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim 
veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip 
ex ea commodo consequat.
`;

let preparedData1 = prepareData(`${text1}`, 'M');
let preparedData2 = prepareData(`${text2}`, 'Q');

describe('getBlocksAmount() return amount of data blocks', () => {
    test('getBlocksAmount("preparedData1", "M") returns 1 block of data', () => {
        expect(
            getBlocksAmount(
                preparedData1.correction,
                preparedData1.version.number
                )
            ).toBe(1);
    });

    test('getBlocksAmount("preparedData2", "M") returns 8 block of data', () => {
        expect(
            getBlocksAmount(
                preparedData2.correction,
                preparedData2.version.number
                )
            ).toBe(8);
    });
});


let blocks1 = divideIntoBlocks(preparedData1).blocks;
let blocks2 = divideIntoBlocks(preparedData2).blocks;

describe('divideIntoBlocks() devide bit stream to blocks using encoding version', () => {
    test('divideIntoBlocks("preparedData1") returns ', () => {
        expect(blocks1).toEqual(expect.arrayContaining(["00100000111000110000101101111000110011000000000011101100000100011110110000010001111011000001000111101100000100011110110000010001"]));
    });

    test('divideIntoBlocks("preparedData2") returns ', () => {
        expect(
            blocks2
        ).toEqual(expect.arrayContaining([
            '00101001110011101111001001100110011011000000001001101000011101000010101000000001001001100001011110010011001110001110011111110101001111010011101100001010010011110011000001000100',
            '11111001111101001000111001010100100111010110000111001011110010010110111000111011110011111000011010000010101111010001010001011011010001111100111000001010000011110011000011000101',
            '11000101000100010101100010011111101100100110110110100100111011111101111000101001111001100110100000101110110011011101100110111101010111011010011110110101100011110011010010011100',
            '11011000101001101010011010010100100111100110000110001001101100010100110101001101001111101000010111001110011110011000111010111011010001001010101000011110000110101011000111100110',
            '0010100000111011000000001000111001111110011010100110100000101101000000100100101100000011000001110100111011000110011011101010101100010100010000100001000111010000100110011011101010011011',
            '0101010010111010100100010100010111010100100011101001010111000100111111001110010011110001100011101100001000110100110011010010011100110110001010011011010001101100110101101101000110011010',
            '0111010101100011110010111100111100001110010110000011010000111001000101001011111001100010001111001100100011010001111110100100010001011000101110001000110100100001001110101001000010101010',
            '0001010100001100111011000001000111101100000100011110110000010001111011000001000111101100000100011110110000010001111011000001000111101100000100011110110000010001111011000001000111101100'
          ]));
    });
});
